\documentclass{beamer} 
\usepackage{upquote}
\usepackage{multirow}
\usepackage{caption}
 \captionsetup{font=scriptsize}
\usepackage{algorithm}
\usepackage{tabularx}
\usepackage{colortbl}% http://ctan.org/pkg/colortbl
\usepackage{booktabs}
\usepackage{adjustbox}
\usepackage[noend]{algorithmic}
\usepackage{fancybox}
\floatname{algorithm}{Procedure}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\usepackage{wrapfig}
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}[frame number]

\usetheme[height=0mm]{Rochester}

%\setbeamertemplate{footline}%{miniframes theme}
% {%
%   \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
%     leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
%     {\usebeamerfont{title in head/foot}\insertshorttitle} \hfill     \insertframenumber%
%   \end{beamercolorbox}%
% }











\colorlet{tableheadcolor}{gray!25} % Table header colour = 25% gray
\newcommand{\headcol}{\rowcolor{tableheadcolor}} %
\colorlet{tablerowcolor}{gray!10} % Table row separator colour = 10% gray
\newcommand{\rowcol}{\rowcolor{tablerowcolor}} %
    % Command \topline consists of a (slightly modified) \toprule followed by a \heavyrule rule of colour tableheadcolor (hence, 2 separate rules)
\newcommand{\topline}{\arrayrulecolor{black}\specialrule{0.1em}{\abovetopsep}{0pt}%
            \arrayrulecolor{tableheadcolor}\specialrule{\belowrulesep}{0pt}{0pt}%
            \arrayrulecolor{black}}
    % Command \midline consists of 3 rules (top colour tableheadcolor, middle colour black, bottom colour white)
\newcommand{\midline}{\arrayrulecolor{tableheadcolor}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}\specialrule{\lightrulewidth}{0pt}{0pt}%
            \arrayrulecolor{white}\specialrule{\belowrulesep}{0pt}{0pt}%
            \arrayrulecolor{black}}
    % Command \rowmidlinecw consists of 3 rules (top colour tablerowcolor, middle colour black, bottom colour white)
\newcommand{\rowmidlinecw}{\arrayrulecolor{tablerowcolor}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}\specialrule{\lightrulewidth}{0pt}{0pt}%
            \arrayrulecolor{white}\specialrule{\belowrulesep}{0pt}{0pt}%
            \arrayrulecolor{black}}
    % Command \rowmidlinewc consists of 3 rules (top colour white, middle colour black, bottom colour tablerowcolor)
\newcommand{\rowmidlinewc}{\arrayrulecolor{white}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}\specialrule{\lightrulewidth}{0pt}{0pt}%
            \arrayrulecolor{tablerowcolor}\specialrule{\belowrulesep}{0pt}{0pt}%
            \arrayrulecolor{black}}
    % Command \rowmidlinew consists of 1 white rule
\newcommand{\rowmidlinew}{\arrayrulecolor{white}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}}
    % Command \rowmidlinec consists of 1 tablerowcolor rule
\newcommand{\rowmidlinec}{\arrayrulecolor{tablerowcolor}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}}
    % Command \bottomline consists of 2 rules (top colour
\newcommand{\bottomline}{\arrayrulecolor{white}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}\specialrule{\heavyrulewidth}{0pt}{\belowbottomsep}}%
\newcommand{\bottomlinec}{\arrayrulecolor{tablerowcolor}\specialrule{\aboverulesep}{0pt}{0pt}%
            \arrayrulecolor{black}\specialrule{\heavyrulewidth}{0pt}{\belowbottomsep}}%









\useinnertheme{rectangles}
\newcommand{\LINEIF}[2]{%
    \STATE\algorithmicif\ {#1}\ \algorithmicthen\ {#2} \ %algorithmicend\ \algorithmicif%
}

\title[Master thesis presentation: Mining adverse events from healthcare data]
{Master thesis presentation: Mining adverse events from healthcare data}
\author[Dries Van Daele]{Dries Van Daele}
\institute{KU Leuven, DTAI}
\date{6 september, 2013}

\begin{document}

\begin{frame}{}
  \titlepage
\end{frame}

\begin{frame}{Problem description}
Problem: voluntary reporting records a fraction of the adverse events\vspace{3 mm}


manual detection
\begin{itemize}
\item is costly
\item is limited in scope
\item is driven by intuition
\end{itemize}
data mining
\begin{itemize}
\item treats all patient data uniformly
\item can reason over all relevant data
\item enables automation
\item makes biases explicit
\end{itemize}
\end{frame}


\begin{frame}{Problem description}
Task: Apply data mining on a given database to detect adverse events or discover novel adverse event triggers
\begin{figure}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{kdd}
{\footnotesize \caption{http://www.kdnuggets.com/gpspubs/aimag-kdd-overview-1996-Fayyad.pdf}}
\end{figure}

\end{frame}


% \begin{frame}{Methodology}
%   \centering
%   % \adjustbox{max height=\dimexpr\textheight/3\relax,
%   % max width=\textwidth}{
%   \begin{tabular}{| l | l | l | l |}
%     \hline
%     patient\_id & birth\_date  & gender \\ \hline
%     patient\_1  & 12-AUG-1956 & M \\
%     patient\_2  & 21-FEB-1973 & F \\
%     patient\_3  & 30-AUG-1989 & M \\
%     \hline
%   \end{tabular}

%   \begin{tabular}{| l | l | l | l|}
%     \hline
%     medical\_case\_id  & patient\_id & admission\_date & discharge\_date \\ \hline
%     medical\_case\_100 & patient\_1  & 17-JAN-2009    & 19-JAN-2009    \\
%     medical\_case\_101 & patient\_1  & 03-SEP-2009    & 27-SEP-2009    \\
%     medical\_case\_102 & patient\_2  & 06-NOV-2010    & 13-NOV-2010    \\
%     medical\_case\_103 & patient\_3  & 21-DEC-2010    & 03-JAN-2011    \\
%     medical\_case\_104 & patient\_3  & 28-MAR-2012    & 02-JUN-2012    \\
%     \hline
%   \end{tabular}
  
%   \begin{tabular}{| l | l | l |}
%     \hline
%     diagnose\_id & medical\_case\_id  & ICD\_code \\ \hline
%     diagnose\_1  & medical\_case\_101 & F48      \\
%     diagnose\_2  & medical\_case\_101 & T85.4    \\
%     diagnose\_3  & medical\_case\_103 & F41.0    \\
%     diagnose\_4  & medical\_case\_103 & F48.0    \\
%     diagnose\_5  & medical\_case\_103 & R55      \\
%     \hline
%   \end{tabular}
% \end{frame}

% 

% \begin{frame}{Data Preparation}
% \includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{g0}
% \end{frame}



\begin{frame}{Data Preparation}
\begin{columns}
\begin{column}{.3\textwidth}
%\color{red}\rule{\linewidth}{4pt}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{g1}

\end{column}%
\hfill%
\begin{column}{.66\textwidth}
%\color{blue}\rule{\linewidth}{4pt}
  \centering

\begin{tabular}{lll}
  \topline
  \headcol patient\_id & birth\_date & gender \\
  \midline
  patient\_1 & 07-MAR-1965 & M \\
  \ldots & \ldots & \ldots \\
  \bottomlinec
\end{tabular}
  % \begin{tabular}{| l | l | l | l |}
  %   \hline
  %   patient\_id & birth\_date  & gender \\ \hline
  %   patient\_1  & 12-AUG-1956 & M \\
  %   \ldots  & \ldots & \ldots \\
  %   \hline
  % \end{tabular}

\vspace{.3cm}

\adjustbox{max width=\textwidth}{
\begin{tabular}{llll}
  \topline
  \headcol medical\_case\_id  & patient\_id & admission\_date & discharge\_date \\
  \midline
    medical\_case\_100 & patient\_1  & 12-JUL-2007    & 28-JUL-2007    \\
    medical\_case\_101 & patient\_1  & 03-FEB-2008    & 06-FEB-2008    \\
    \ldots & \ldots  & \ldots    & \ldots    \\
  \bottomlinec
\end{tabular}
}
  % \adjustbox{max width=\textwidth}{
  % \begin{tabular}{| l | l | l | l|}
  %   \hline
  %   medical\_case\_id  & patient\_id & admission\_date & discharge\_date \\ \hline
  %   medical\_case\_100 & patient\_1  & 17-JAN-2009    & 19-JAN-2009    \\
  %   medical\_case\_101 & patient\_1  & 03-SEP-2009    & 27-SEP-2009    \\
  %   \ldots & \ldots  & \ldots    & \ldots    \\
  %   \hline
  % \end{tabular}}
\vspace{.3cm}

\begin{tabular}{lll}
  \topline
  \headcol     diagnose\_id & medical\_case\_id  & ICD\_code \\
  \midline
    diagnose\_1  & medical\_case\_101 & J01      \\
    diagnose\_2  & medical\_case\_101 & N18    \\
    \ldots  & \ldots & \ldots   \\
  \bottomlinec
\end{tabular}
  
  % \begin{tabular}{| l | l | l |}
  %   \hline
  %   diagnose\_id & medical\_case\_id  & ICD\_code \\ \hline
  %   diagnose\_1  & medical\_case\_101 & F48      \\
  %   diagnose\_2  & medical\_case\_101 & T85.4    \\
  %   \ldots  & \ldots & \ldots   \\
  %   \hline
  % \end{tabular}

  % \begin{tabular}{| l | l | l |}
    
  % \end{tabular}
\end{column}%
\end{columns}
\end{frame}

\begin{frame}[fragile]{Data Preparation}
\begin{columns}
\begin{column}{.3\textwidth}
%\color{red}\rule{\linewidth}{4pt}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{g2}

\end{column}%
\hfill%
\begin{column}{.66\textwidth}
{\tiny
\begin{verbatim}
@prefix diagnose: <http://www.example.org/ddo/diagnose#>.
@prefix medical-case: <http://www.example.org/ddo/medical-case#>.
@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.

diagnose:Diagnose a rdfs:Class.
diagnose:diagnose-id a rdf:Property ;
                       rdfs:domain diagnose:Diagnose ;
                       rdfs:range xsd:Literal.
diagnose:medical-case-id a rdf:Property ;
                           rdfs:domain diagnose:Diagnose ;
                           rdfs:range medical-case:Medical-Case.
diagnose:icd-code a rdf:Property ;
                    rdfs:domain diagnose:Diagnose ;
                    rdfs:range xsd:Literal.

...
\end{verbatim}
}
\end{column}%
\end{columns}
\end{frame}


\begin{frame}{Data Preparation}
\begin{columns}
\begin{column}{.3\textwidth}
%\color{red}\rule{\linewidth}{4pt}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{g2}

\end{column}%
\hfill%
\begin{column}{.66\textwidth}
\begin{figure}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{rdb2rdf}
{\footnotesize \caption{http://www.w3.org/2001/sw/rdb2rdf/use-cases/}}
\end{figure}
\end{column}%
\end{columns}
\end{frame}


\begin{frame}[fragile]{Data Preparation}
\begin{columns}
\begin{column}{.3\textwidth}
%\color{red}\rule{\linewidth}{4pt}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{g3}
\end{column}%
\hfill%
\begin{column}{.66\textwidth}
{\tiny
\begin{verbatim}
@prefix patient: <http://www.example.org/ddo/patient#>.
@prefix heca: <http://www.agfa.com/w3c/2009/healthCare#>.
{
    ?patient a patient:Patient.
} => {
    ?patient a heca:Patient.
}.

...
\end{verbatim}
}
\end{column}%
\end{columns}
\end{frame}






\begin{frame}[fragile]{Data Preparation}
\begin{columns}
\begin{column}{.3\textwidth}
%\color{red}\rule{\linewidth}{4pt}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{g3}
\end{column}%
\hfill%
\begin{column}{.66\textwidth}
{\tiny
\begin{verbatim}
@prefix orgStructure: <http://www.example.org/ddo/orgStructure#>.
@prefix space: <http://eulersharp.sourceforge.net/2003/03swap/space#>.
{
    _:structure
        orgStructure:structID ?s ;
        orgStructure:innerStructID ?is .
} => {
    ?is space:containedBy ?s .
}.

{
    ?startNode space:containedBy ?middleNode .
    ?middleNode space:containedBy ?endNode .
} => {
    ?startNode space:containedBy ?endNode .
}.

...
\end{verbatim}
}
\end{column}%
\end{columns}
\end{frame}

\begin{frame}{Data Preparation}
\begin{columns}
\begin{column}{.3\textwidth}
%\color{red}\rule{\linewidth}{4pt}
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{prologkb}
\end{column}%
\hfill%
\begin{column}{.66\textwidth}
  \begin{itemize}
  \item include ATC and ICD hierarchy
  \item add ad hoc predicates (e.g. discretise age, distinguish acute from chronic disorders)
  \item final theory $\approx 43,000,000$ clauses
  \end{itemize}
\end{column}%
\end{columns}

\end{frame}

\begin{frame}[fragile]{Data mining approach}
 \begin{minipage}{\textwidth}
\begin{figure}
\includegraphics[width=\textwidth,keepaspectratio]{timeline_final2}
\end{figure}
  \end{minipage}
  \vfill
  \begin{minipage}{\textwidth}
    \centering
{\tiny
\begin{verbatim}
patient_gender(patient_1, male).
patient_birth_date(patient_1, '1965-03-07').
patient_medical_case_dates(patient_1, medical_case_100, '2007-07-12','2007-07-28').
patient_disorder(patient_1, 'I20.9', '2007-07-12').
patient_disorder(patient_1, 'I65.2', '2007-07-12').
patient_disorder(patient_1, 'K76.9', '2007-07-17').
patient_disorder(patient_1, 'N18', '2007-07-19').
patient_drug(patient_1, 'B01AC04', '2007-07-12').
...
\end{verbatim}
}
\end{minipage}
\end{frame}

\begin{frame}{Data mining approach}


 \begin{minipage}{\textwidth}
\begin{figure}
\includegraphics[width=\textwidth,keepaspectratio]{timeline_final2}
\end{figure}
  \end{minipage}
  \vfill
  \begin{minipage}{\textwidth}
\begin{itemize}
\item detect adverse events given a particular treatment/trigger \pause
\item no labelled data \pause
\item reverse machine learning to target relevant patterns (MONADIC experiment)\pause
\item induce generally applicable rules from patient data
\end{itemize}
\end{minipage}
\end{frame}

\begin{frame}{Collecting evidence}
\begin{table}[!ht]  
\includegraphics[width=\textwidth,height=.88\textheight,keepaspectratio]{plot_drug_prescriptions}
\end{table}
\end{frame}

\begin{frame}{Collecting evidence}
\begin{table}[!ht]  
  \centering
  \begin{tabularx}{\textwidth}{| l | l | X |}
    \cline{2-3}
    \multicolumn{1}{l|}{} 
    & positive examples & negative examples \\ \hline
    BUN$>$60 mg/dl & 531 & 1477 \\
    readm. within 30 days & 37058 & 222388 \\ 
    Agopton & 141 & 141 \\
    Marcoumar & 166 & 166 \\
    Nexium & 224 & 224 \\
    Plavix & 174 & 174 \\
    Trental & 80 & 80 \\
    Urosin & 121 & 121 \\ \hline
  \end{tabularx}
\caption {Target attribute characteristics}
  \label{evidence-table}
\end{table}
\end{frame}

\begin{frame}{Exploratory manual detection adverse events}
\begin{table}[!ht]  
\includegraphics[width=\textwidth,height=.75\textheight,keepaspectratio]{bar_chart_filtered_data}
\end{table}

\end{frame}

\begin{frame}{Data mining technique characteristics (Aleph)}
  \begin{itemize}
  \item support relational input data \pause 
    \begin{itemize}
      \item examples are Prolog facts
      \item hypothesis is a set of clauses (learning a predicate)
      \item background knowledge can rely on all Prolog features \pause
    \end{itemize} 
  \item perform induction \pause
    \begin{itemize}
    \item Progol algorithm \pause
    \end{itemize}
  \item incorporate reverse machine learning \pause
    \begin{itemize}
      \item using positive and negative examples of the chosen target attribute \pause
    \end{itemize}
  \item handle probability \pause
    \begin{itemize}
      \item clause evaluation functions rely on frequency counts of the true and false positives
    \end{itemize}

  \end{itemize}
\end{frame}

\begin{frame}[fragile]{Aleph usage}
core vocabulary:
{\tiny
\begin{verbatim}
patient_disorder(Patient_Id, ICD_Uri, DateTime).
patient_drug(Patient_Id, ATC_Uri, DateTime).
patient_age_at_date(Patient_Id, DateTime, Age_Interval).
patient_gender(Patient_Id, Gender).
patient_birth_date(Patient_Id, Birth_Date).
patient_death_date(Patient_Id, Death_Date).
patient_transfer_data(Patient_Id, From_Location, To_Location, DateTime).
icd_class_in_icd_superclass(ICD_Class, ICD_Superclass).
atc_uri_in_atc_category(ATC_Uri, ATC_Category).
\end{verbatim}
}
space of legal clauses is constrained using 
\begin{itemize}
\item user-defined prune statements
\item integrity constraints
\end{itemize}
acceptable clauses need to
\begin{itemize}
  \item cover at least 2 positive examples
  \item have a precision of at least 60\%
\end{itemize}
\end{frame}

\begin{frame}{Conclusions}
\begin{table}
  \begin{tabular}{l|l|c|c|c}
    \multicolumn{2}{c}{}&\multicolumn{2}{c}{Actual example class}&\\
    \cline{3-4}
    \multicolumn{2}{c|}{}&Positive&Negative&\multicolumn{1}{c}{Total}\\
    \cline{2-4}
    \multirow{2}{*}{Predicted example class}& Positive & $65$ & $1$ & $66$\\
    \cline{2-4}
    & Negative & $466$ & $1476$ & $1942$\\
    \cline{2-4}
    \multicolumn{1}{c}{} & \multicolumn{1}{c}{Total} & \multicolumn{1}{c}{$531$} & \multicolumn{1}{c}{$1477$} & \multicolumn{1}{c}{$2008$}\\
  \end{tabular}
  \caption {confusion matrix for the theory on the BUN$>$60 mg/dl trigger}
  \label{confusion-matrix-bun}
\end{table}
\pause
\begin{itemize}
\item Medicines: challenges \pause
  \begin{itemize}
  \item limited amount of data
  \item heterogeneous set of adverse events
  \item irrelevant correlation \pause
  \end{itemize}
\item Readmission within 30 days: challenges \pause
  \begin{itemize}
  \item limited domain knowledge
  \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Questions}
\centering
Thanks for your attention
\end{frame}

% % \begin{lstlisting}[style=rdf,float, caption={Two rules in N3, one imposes a space:containedBy relation, the other expresses the transitive closure over this relation}, label=rule_example]
% % @prefix orgStructure: <http://www.example.org/database/ddo/orgStructure#> .
% % @prefix space: <http://eulersharp.sourceforge.net/2003/03swap/space#> .

% % {
% %         _:structure 
% %                 orgStructure:structID ?s ;
% %                 orgStructure:innerStructID ?is .
% % } => {
% %         ?is space:containedBy ?s .  
% % } .

% % {
% %         ?startNode space:containedBy ?middleNode .
% %         ?middleNode space:containedBy ?endNode .
% % } => {
% %         ?startNode space:containedBy ?endNode .
% % } .
% % \end{lstlisting}

% \end{frame}
\end{document}